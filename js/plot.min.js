$(document).ready(function(){var e="https://db.softver.org.mk/influxdb/query",n="status",t={color:"#333",highlightColor:"#333",legend:{margin:[10,10],backgroundColor:"#fff",position:"nw"},shadowSize:0,grid:{borderColor:"#ddd",margin:{top:0,left:20,bottom:0,right:0}},lines:{show:!0},points:{show:!1},xaxis:{labelWidth:50,mode:"time",timezone:"browser",minTickSize:[15,"minute"]},colors:plot_colors};function r(r){var o,a,u,l=r.data("influx-url")||e,s=r.data("influx-dbname")||n,d=r.data("influx-query"),c=r.data("plot-options");c=$.extend({},t,c);return(o=l,a=s,u=d,$.ajax({url:o,data:{db:a,q:u,epoch:"ms"}})).then(function(e,n){if(e&&e.results&&e.results.length>0&&e.results[0].series&&e.results[0].series.length>0)return function(e,n){for(var t=[],r=1;r<e.columns.length;r++)t.push(i(e,r,n));return t}(e.results[0].series[0],c)}).then(function(e){r.plot(e,c)})}function o(e,n){return e-n}function i(e,n,t){var r={};if(r.label=e.columns[n],t.calcMedian){for(var i=e.values,a=[],u=1;u<i.length-1;++u){var l=[i[u-1][n],i[u][n],i[u+1][n]].sort(o)[1];a.push([i[u][0],l])}r.data=a}else r.data=e.values.map(function(e){return[e[0],e[n]]});return r}$("div[data-influx-query]").each(function e(){var n=$(this);var t=r(n);n.overlayLoader(t);t.then(function(){n.one("click",e)})}),$(".btn-refresh").click(function(){var e=$(this).parent().parent().parent().parent().children(".panel-body").children("div[data-influx-query]"),n=r(e);e.overlayLoader(n)})}),function(e){e.wait=function(n){return e.Deferred(function(e){setTimeout(e.resolve,n)}).promise()}}(jQuery),function(e){e.fn.overlayLoader=function(n){return this.each(function(){var t=e(this),r=e('<div class="loader"></div>');t.append(r),n&&n.then&&n.then(function(){r.remove()},function(){r.remove()})})}}(jQuery);