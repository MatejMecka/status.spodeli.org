var INFLUXDB_URL="https://db.softver.org.mk/influxdb/query",INFLUXDB_DBNAME="status",noInternetAccess=!1;function updateStatus(){var e=$("#status").attr("data-influx-query"),t=$("#status").parent().parent();$.ajax({url:INFLUXDB_URL,type:"GET",dataType:"json",data:{db:INFLUXDB_DBNAME,q:e,epoch:"ms"}}).then(function(e){var a=(new Date).getTime(),s=e.results[0].series[0].values[0],n=s[0],r=s[1],o=secondsToString((a-n)/1e3);noInternetAccess||(t.removeClass("panel-open panel-closed"),"CLOSED"===r?($("#status").text("Затворен"),t.addClass("panel-closed"),$("#status-time").text("веќе "+o)):($("#status").text("Отворен"),t.addClass("panel-open"),$("#status-time").text("пред "+o)))})}function updateDevices(){var e=$("#currentDevices").attr("data-influx-query"),t=$("#currentDevices").parent().parent();$.ajax({url:INFLUXDB_URL,type:"GET",dataType:"json",data:{db:INFLUXDB_DBNAME,q:e,epoch:"ms"}}).then(function(e){var a=e.results[0].series[0].values[0][1],s="уреди";t.removeClass("panel-danger panel-success"),t.addClass("panel-success"),a%10==1&&11!==a&&(s="уред"),$(".current-devices .value").text("вкупно "+a+" "+s),$(".current-devices .description").text("на мрежата во КИКА")})}function updateNetworkSpeeds(){$.ajax({url:"http://hacklab.ie.mk/ftp/vnstat/json/average.json?callback=?",type:"GET",dataType:"json"}).then(function(e){var t=e.Telekabel,a=e.Blizoo;$("#rxkbs").text(parseFloat(t.rxkbs)+parseFloat(a.rxkbs)+" kB/s"),$("#txkbs").text(parseFloat(t.txkbs)+parseFloat(a.txkbs)+" kB/s")})}function updateTempValues(){var e=$(".temperature-values").attr("data-influx-query");$(".panel-temperature .value").css({color:"inherit"}).html("&#8230;"),$.ajax({url:INFLUXDB_URL,type:"GET",dataType:"json",data:{db:INFLUXDB_DBNAME,q:e,epoch:"ms"}}).then(function(e){var t=e.results[0].series[0].values[0][0],a=((new Date).getTime()-t)/1e3;if(noInternetAccess=!1,a>3600){noInternetAccess=!0;var s=$("#status").parent().parent();s.removeClass("panel-open panel-closed"),$("#status").text("Непознато"),s.addClass("panel-closed");var n=secondsToString(a);$("#status-time").text("нема одговор веќе "+n)}else window.console&&console.log("timestamp="+t+" timediff="+a);for(var r=e.results[0].series[0].columns,o=e.results[0].series[0].values[0],l=1;l<o.length;l++){var u="";u=o[l]?o[l]+"&deg;C":"не се мери",$("#"+r[l]+" span.value").html(u).css({color:plot_colors[l-1]})}})}function secondsToString(e){var t=Math.round(e/604800),a=Math.round(e/86400),s=Math.round(a-7*t),n=Math.floor(e/3600),r=Math.floor(e%86400%3600/60),o="недели",l="дена",u="дена",c="часа",i="минути";return t%10==1&&11!==t&&(o="недела"),s%10==1&&11!==s&&(u="ден"),a%10==1&&11!==a&&(l="ден"),n%10==1&&11!==n&&(c="час"),r%10==1&&11!==r&&(i="минута"),a>7?s>0?t+" "+o+" и "+s+" "+u:t+" "+o:n>24?a+" "+l:n+" "+c+" и "+r+" "+i}function shuffle(e){for(var t,a,s=e.length;s;t=Math.floor(Math.random()*s),a=e[--s],e[s]=e[t],e[t]=a);return e}function populateTumblr(e){var t=shuffle(tumblr_api_read.posts),a="";$(t).each(function(t,s){a=t<1?"active":"",$(e.selector).find(".carousel-inner").append('<div class="item '+a+'"><img src="'+s["photo-url-500"]+'" ></div>')})}$(document).ready(function(){function e(){$("body").toggleClass("modal-open")}$(document).keypress(function(t){27==t.keyCode&&(e(),window.location.hash="/")}),$(".btn-grafana").click(function(){window.location="http://grafana.softver.org.mk/"}),$(".modal-toggle").click(function(t){e()}),updateStatus(),updateDevices(),window.location.href.indexOf("info-panel")>-1&&(populateTumblr($("#tumblr")),populateTumblr($("#tumblr2")),$(".carousel").carousel({interval:8e3}));window.setInterval(updateStatus,3e5),window.setInterval(updateDevices,3e5)});