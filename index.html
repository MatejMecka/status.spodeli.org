<!DOCTYPE html>
<html>
    <head>
        <title>status.spodeli.org</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/style.css">
    </head>
    <body>
        <div class="container">
            <header class="page-header">
                <div class="row">
                    <div class="col-md-1">
                        <a href="#"><figure><img class="logo img-responsive" width="80" height="80" src="svg/kika-logo-symbol-only-c2b.svg" alt="лого на хаклаб КИКА"></figure></a>
                    </div>
                    <div class="col-md-5">
                        <h1><a href="#">Xаклаб КИКА, сега</a></h1>
                        <p class="text-muted">КИКА е отворен простор на ул. „Васил Стефановски“ бр.8/1 во центарот на Скопје. <a href="http://b10g.spodeli.org/">Дознајте повеќе</a></p>
                        <hr class="hidden-lg hidden-md">
                    </div>
                    <div class="col-md-2">
                        <ul class="list-unstyled">
                            <li>
                                <span class="glyphicon glyphicon-file"></span>
                                <a class="glyphicon-text" href="http://b10g.spodeli.org/">Блог на КИКА</a>
                            </li>
                            <li>
                                <span class="glyphicon glyphicon-info-sign"></span>
                                <a class="glyphicon-text" href="http://b10g.spodeli.org/p/blog-page_17.html">Контакт</a>
                            </li>
                            <li>
                                <span class="glyphicon glyphicon-piggy-bank"></span>
                                <a class="glyphicon-text" href="http://b10g.spodeli.org/p/blog-page_19.html">Донации</a>
                            </li>
                            <li>
                                <span class="glyphicon glyphicon-book"></span>
                                <a class="glyphicon-text" href="https://wiki.spodeli.org/">Вики</a>
                            </li>
                        </ul>
                        <hr class="hidden-lg hidden-md">
                    </div>
                    <div class="col-md-4">
                        <ul class="list-unstyled">
                            <li>Сметка: <strong>210057088340110</strong></li>
                            <li>Банка: <strong>НЛБ Тутунска Скопје</strong></li>
                            <li>Приходна шифра: <strong>562 (Уплати за донации)</strong></li>
                            <li>Цел на дознака: <strong>донација за проект КИКА</strong></li>
                        </ul>
                    </div>
                </div>
            </header>
            <div class="row">
                <div class="col-lg-6">
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="panel panel-default panel-open">
                                <div class="panel-body info-block">
                                    <span class="value text-uppercase">Oтворен</span>
                                    <span class="description">пред 12 часа и 19 минути</span>
                                </div>
                            </div>
                        </div>
                        <!--                        <div class="col-lg-6">
                                                    <div class="panel panel-default panel-closed">
                                                        <div class="panel-body info-block">
                                                            <span class="value text-uppercase">Затворен</span>
                                                            <span class="description">веќе 12 часа и 19 минути</span>
                                                        </div>
                                                    </div>
                                                </div>-->
                        <div class="col-lg-6">
                            <div class="panel panel-success">
                                <div class="panel-body info-block">
                                    <span class="value">3 уреди</span>
                                    <span class="description">најавени на мрежата во КИКА</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="panel panel-info">
                                <div class="panel-body info-block">
                                    <span class="value">14.640 ден.</span>
                                    <span class="description">на располагање на КИКА</span>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <p><a role="button" class="btn btn-success btn-block" href="#">Зачленете се</a></p>
                            <p><a role="button" class="btn btn-info btn-block" href="http://b10g.spodeli.org/p/blog-page_19.html">Донирајте</a></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <!-- Присутни, за кога ќе биде потребно
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Присутни</h3>
                        </div>
                        <div class="panel-body">
                            <ul class="list-inline list-avatars">
                                <li><a href="#" title="@Twitter_Name"><img src="https://avatars2.githubusercontent.com/u/502412?v=3&amp;s=96" alt="avatar"></a></li>
                                <li><a href="#" title="@Twitter_Name"><img src="https://avatars1.githubusercontent.com/u/81654?v=3&amp;s=96" alt="avatar"></a></li>
                                <li><a href="#" title="@Twitter_Name"><img src="https://avatars0.githubusercontent.com/u/359855?v=3&amp;s=96" alt="avatar"></a></li>
                            </ul>
                        </div>
                    </div>
                    -->
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Уреди во хаклаб</h3>
                        </div>
                        <div class="panel-body">
                            <div class="graph devices"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Температурата во хаклаб</h3>
                        </div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-3 col-sm-6 col-xs-6">
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div class="info-block">
                                                <span id="tempHardware" class="value hot">30&deg;C</span>
                                                <span class="description">Хардвер</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6 col-xs-6">
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div class="info-block">
                                                <span id="tempLounge" class="value warm">24&deg;C</span>
                                                <span class="description">Ходник</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6 col-xs-6">
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div class="info-block">
                                                <span id="tempRandom" class="value warm">21&deg;C</span>
                                                <span class="description">Рандом</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 col-sm-6 col-xs-6">
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div class="info-block">
                                                <span id="tempOutside" class="value cold">5&deg;C</span>
                                                <span class="description">Тераса</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="graph temperature"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script src="flot-flot-958e5fd/jquery.js"></script>
        <script src="flot-flot-958e5fd/jquery.flot.js"></script>
        <script src="flot-flot-958e5fd/jquery.flot.time.js"></script>
        <script src="flot-flot-958e5fd/jquery.flot.resize.js"></script>
        <script>
            $(document).ready(function () {

                var graphOptions = {
                    color: "#333",
                    highlightColor: "#333",
                    legend: {
                        margin: [10, 10],
                        backgroundColor: "#fff"
                    },
                    shadowSize: 0,
                    grid: {
                        borderColor: "#ddd",
                        margin: {top: 0, left: 20, bottom: 0, right: 0}
                    },
                    lines: {show: true},
                    points: {show: false},
                    xaxis: {
                        labelWidth: 50,
                        mode: "time",
                        minTickSize: [15, "minute"]
                    },
                    yaxis: {}
                };

                $.ajax({
                    url: 'https://db.softver.org.mk/influxdb/query',
                    data: {db: 'status', q: "SELECT outside,random_room,lounge_area,hardware_room FROM temperatures WHERE location='hacklab' AND time > now() - 1d"},
                    type: "GET",
                    dataType: "json"
                }).then(function (data, status) {
                    var series = data.results[0].series[0];
                    var plotdata = massage_influx_data_for_flot(series);
                    var options = graphOptions;
                    $(".graph.temperature").plot(plotdata, options);
                });

                $.ajax({
                    url: 'https://db.softver.org.mk/influxdb/query',
                    data: {db: 'status', q: "SELECT value FROM landevices WHERE location='hacklab' AND time > now() - 1d"},
                    type: "GET",
                    dataType: "json"
                }).then(function (data, status) {
                    var series = data.results[0].series[0];
                    var plotdata = massage_influx_data_for_flot(series);
                    var options = graphOptions;
                    $(".graph.devices").plot(plotdata, options);
                });

                function massage_influx_data_for_flot(series) {
                    var plotdata = [];
                    for (var k = 1; k < series.columns.length; k++) {
                        plotdata.push(make_serie(series, k));
                    }
                    return plotdata;
                }

                function make_serie(series, index) {
                    var serie = {};
                    serie.label = series.columns[index];
                    serie.data = series.values.map(function (value) {
                        var timestamp = value[0];
                        timestamp = (new Date(timestamp)).getTime();
                        return [timestamp, value[index]];
                    });
                    return serie;
                }

            });
        </script>
    </body>
</html>